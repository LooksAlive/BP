{% extends "base.html" %}

{% block title %}Admin Užívatelia{% endblock %}

{% block content %}
<style>
    .truncate-cell {
        max-width: 200px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        cursor: pointer;
        position: relative;
    }
    
    .truncate-cell:hover {
        white-space: normal;
        overflow: visible;
        max-height: none;
        z-index: 1;
        position: absolute;
        background-color: #fff; 
        padding: 5px; 
        border: 1px solid #ccc; 
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.2); 
        max-width: 100%; 
        box-sizing: border-box; 
    }
</style>
<h1 class="mb-4">Admin Užívatelia</h1>

<!-- Add Table for displaying users -->
<table class="table table-striped">
    <thead class="thead-light">
        <tr>
            <th>ID</th>
            <th>Email</th>
            <th>Meno</th>
            <th>Heslo</th>
            <th>Rola</th>
            <th>Akcie</th>
        </tr>
    </thead>
    <tbody>
        <!-- Prechádzajte užívateľmi a zobrazujte ich v riadkoch -->
        {% for user in users %}
            <tr>
                <td>{{ user.id }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.username }}</td>
                <td class="truncate-cell" data-content="{{ user.password }}">{{ user.password }}</td>
                <td>
                    {% for group in user.groups.all %}
                        {{ group.name }}
                    {% empty %}
                        None
                    {% endfor %}
                </td>
                <td>
                    <!-- Tlačidlo Aktualizovať pomocou formulára so skrytým vstupom -->
                    <form method="get" action="{% url 'admin_edit_user' user.id %}" style="display: inline;">
                        {% csrf_token %}
                        <input type="submit" class="btn btn-primary btn-update" value="Upraviť">
                    </form>

                    <!-- Tlačidlo Odstrániť pomocou formulára so skrytým vstupom -->
                    <form method="post" action="{% url 'admin_delete_user' user.id %}" style="display: inline;">
                        {% csrf_token %}
                        <input type="submit" class="btn btn-danger btn-delete" value="Vymazať" onclick="return confirm('Potvrdďte akciu?');">
                    </form>
                </td>
            </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Tlačidlo na prepínanie vstupných polí na pridanie nového užívateľa -->
<button id="addUserButton" class="btn btn-success mb-4">Pridaj Užívateľa</button>

<!-- Vstupné polia na pridanie nového užívateľa (na začiatku skryté) -->
<div id="addUserFields" style="display: none">
    <form method="post" action="{% url 'admin_create_user' %}">
        {% csrf_token %}
        
        <div class="form-group">
            <label for="username">Meno</label>
            <input type="text" class="form-control" id="username" name="username" placeholder="Enter your username" value="" required>
        </div>
        <div class="form-group">
            <label for="password">Heslo</label>
            <input type="password" class="form-control" id="password" name="password" placeholder="Enter a new password">
        </div>     
        <div class="form-group">
            <label for="email">Email</label>
            <input type="email" class="form-control" id="email" name="email" value="" placeholder="Enter email" required>
        </div>   
        <div class="form-group">
            <label for="group">Rola</label>
            <select class="form-control" id="group" name="group">
                <!-- <option value="">Select a Role</option> -->
                {% for group in groups %}
                    <option value="{{ group.name }}">{{ group.name }}</option>
                {% endfor %}
            </select>
        </div>
        <button type="submit" class="btn btn-success">Potvrdiť</button>
    </form>
</div>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>
    document.getElementById('addUserButton').addEventListener('click', function () {
        const addUserFields = document.getElementById('addUserFields');
        addUserFields.style.display = addUserFields.style.display === 'none' ? 'block' : 'none';
    });
</script>
{% endblock %}
